%% ===========================================================
%% Petal Flight System Architecture ðŸŒ¿ (Horizontal + Expanded Spacing)
%% ===========================================================
graph LR

%% -------------------- STYLE DEFINITIONS --------------------
classDef primary fill:#32a852,stroke:#1e7035,color:white,font-weight:bold;
classDef cloud fill:#d9f5e2,stroke:#32a852,stroke-width:2px,color:#000;
classDef edge fill:#e3fcef,stroke:#32a852,stroke-width:2px,color:#000;
classDef pixhawk fill:#e0f0ff,stroke:#057cf2,stroke-width:2px,color:#000;
classDef operator fill:#fff2cc,stroke:#f2b705,stroke-width:2px,color:#000;
classDef leftalign text-align:left;

linkStyle default stroke-width:2px,stroke:#32a852

%% ===========================================================
%% OPERATIONAL STAGES (HORIZONTAL + LEFT-ALIGNED TITLES)
%% ===========================================================

%% --- Commissioning Stage ---
subgraph Stage_Commissioning["ðŸ§© Commissioning Stage"]
direction TB
class Stage_Commissioning leftalign
    subgraph Cloud["ðŸŒ Cloud (fly.droneleaf.io)"]
    direction TB
        WebClient["ðŸ’» WebClient"]
        class WebClient cloud;
    end
end

%% --- Shared Stage ---
subgraph Stage_Shared["ðŸ”&nbsp;Shared&nbsp;Commissioning+Flight"]
direction TB
class Stage_Shared leftalign
    subgraph Edge_Shared["ðŸ§  Edge (Raspberry Pi / Jetson Orin)"]
    direction TB
        ControllerDashboard["ðŸ“Š ControllerDashboard"]
        PetalAppManager["âš™ï¸ PetalAppManager"]
        MAVLinkRouter["ðŸ”€ MAVLinkRouter"]
        class ControllerDashboard,PetalAppManager,MAVLinkRouter edge;
    end
end

%% --- Flight Stage ---
subgraph Stage_Flight["âœˆï¸ Flight Stage"]
direction TB
class Stage_Flight leftalign
    subgraph Edge_Flight["ðŸ§  Edge (Raspberry Pi / Jetson Orin)"]
    direction TB
        LeafFC["ðŸŒ¿ LeafFC"]
        DynamoDB["ðŸ—„ï¸ DynamoDB"]
        class LeafFC,DynamoDB edge;
    end

    subgraph Pixhawk["ðŸ›°ï¸ Pixhawk Hardware"]
    direction TB
        PX4["ðŸ§  PX4"]
        class PX4 pixhawk;
    end

    subgraph Operator["ðŸ’» Operator Machine"]
    direction TB
        QGC["ðŸ•¹ï¸ QGroundControl (QGC)"]
        class QGC operator;
    end
end

%% ===========================================================
%% SINGLE CONNECTIONS WITH INLINE LABELS
%% ===========================================================

WebClient -->|"Authentication data, DynamoDB sync, Commissioning, edge apps status<br/>**Transport:** REST, MQTT"| ControllerDashboard
ControllerDashboard -->|"Licensing status, Commissioning, PetalAppManager status<br/>**Transport:** REST, MQTT"| PetalAppManager
ControllerDashboard -->|"Licensing status, LeafFC status<br/>**Transport:** Redis"| LeafFC
PetalAppManager -->|"PX4 Logs, PX4 parameters, Real-time PX4 & LeafFC measurements, SDK related<br/>**Transport:** MAVLink"| MAVLinkRouter
PetalAppManager -->|"SDK related<br/>**Transport:** Redis"| LeafFC
PX4 -->|"PX4 Logs, PX4 parameters, Real-time PX4 & LeafFC measurements, SDK related<br/>**Transport:** MAVLink"| MAVLinkRouter
LeafFC -->|"PX4 parameters, low-frequency measurements, flight commands<br/>**Transport:** MAVLink"| MAVLinkRouter
QGC -->|"SDK related, flight commands, Real-time PX4 & LeafFC measurements<br/>**Transport:** MAVLink"| MAVLinkRouter
LeafFC -->|"Real-time high-frequency measurements, actuator commands<br/>**Transport:** MAVLink"| PX4
LeafFC -->|"Configurations, real-time posted settings, flight records<br/>**Transport:** REST"| DynamoDB
PetalAppManager -->|"Configurations, real-time posted settings, flight records<br/>**Transport:** REST"| DynamoDB
ControllerDashboard -->|"Configurations<br/>**Transport:** REST"| DynamoDB

%% ===========================================================
%% STYLE APPLICATION
%% ===========================================================
class WebClient,ControllerDashboard,PetalAppManager,MAVLinkRouter,LeafFC,PX4,QGC,DynamoDB primary;
